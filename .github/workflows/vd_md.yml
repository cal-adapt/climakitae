name: vd_md

on:
  push:
    paths:
      - 'climakitae/data/variable_descriptions.csv'

jobs:
  markdown:
    #if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
    - name: Checkout project
      uses: actions/checkout@v4
    - name: Setup Python 3.12
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pandas==2.2.3 tabulate==0.9.0 numpy==2.2.6
    - name: Install climakitae
      run: pip install . --no-deps
    - name: Convert to MD
      run: python .github/workflows/vd_md.py $GITHUB_WORKSPACE/climakitae/data/variable_descriptions.csv Variable-Descriptions.md
    - name: Checkout Wiki
      uses: actions/checkout@v4
      with:
        repository: ${{github.repository}}.wiki
        path: ${{github.repository}}.wiki

    - name: Push to wiki
      run: |
        set -e
        cd $GITHUB_WORKSPACE/${{github.repository}}.wiki
        cp $GITHUB_WORKSPACE/Variable-Descriptions.md
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add Variable-Descriptions.md
        git diff-index --quiet HEAD || git commit -m "action: wiki sync" && git push